var ECHARTS_FUNC={select_line_tpl:_.template($("#select_line_tpl").html()),all_china_tpl:_.template($("#all_china_tpl").html()),alert_map_tpl:_.template($("#alert_map_tpl").html()),ready_init:function(){var e=this,t=$(".map-select-content").html("");t.append(e.all_china_tpl()),_.each(GVR.JSON.area_json,function(a,o){var n=e.select_line_tpl({area_key:o,provinces:a});t.append(n)})},area_total_map:function(e,t,a){var o=this,n="jslib/area/"+t+".json",r=/province_/.test(t),i=/province_/.test(t),l=/china/.test(t);r&&(t=t.replace("province_",""),n="jslib/area/province/"+t+".json"),$.get(n,function(n){echarts.registerMap(t,n);var r=echarts.init(document.getElementById(e)),c={backgroundColor:"rgba(0,0,0,0)",title:{left:"center",textStyle:{color:"#fff"}},tooltip:{trigger:"item",formatter:function(e,t,a){if("markPoint"!==e.componentType){var o="";return l?(_.each(GVR.JSON.area_json,function(t,a){_.each(t,function(a){e.name===a&&(o=t[0]+"地区")})}),o+"<br/>医院数量："+e.value+"家"):i?o=e.name:(o=e.name,isNaN(e.value)&&(e.value=0),o+"<br/>医院数量："+e.value+"家")}}},legend:{orient:"vertical",y:"bottom",x:"right",data:a.lend_data,textStyle:{color:"#fff"},selectedMode:"single",selected:a.lend_selected,show:!1},series:[],color:["#939fdf","#f1635e","#ffc528","#00d991","#6bd8ea"]};if(!i){var s={min:0,max:a.max,left:10,text:["高","低"],calculable:!0,itemWidth:30,itemHeight:180,bottom:10,color:["#00c2eb","#081218"],textStyle:{color:"#6bd8ea",fontSize:16}};c.visualMap=s}_.each(a.series,function(e){var a=[{name:"南海诸岛",value:0,itemStyle:{normal:{opacity:0}}}];l?_.each(GVR.JSON.area_json,function(t,o){_.each(t,function(t,n){0!==n&&a.push({name:t,value:e.data[0][o]})})}):i||_.each(e.data,function(e){_.each(e,function(e,t){a.push({name:t,value:e})})});var o={name:e.name,type:"map",mapType:t,roam:!0,showLegendSymbol:!1,zoom:1.1,data:a,markPoint:{symbol:"circle",symbolSize:15,label:{normal:{show:!1,formatter:function(e){return e.name}}},data:e.point,itemStyle:{normal:{color:e.color}}},label:{normal:{formatter:"{b}",position:"right",show:!1},emphasis:{show:!1}},itemStyle:{normal:{areaColor:"#1a3741",color:"#f4e925",borderColor:"#fff"},emphasis:{areaColor:"#6bd8ea",borderWidth:0,borderColor:"rgba(0,0,0,0)"}}};c.series.push(o)}),r.on("mouseover",function(e){"china"===t&&(_.each(GVR.JSON.provinceArray,function(e){r.dispatchAction({type:"mapUnSelect",name:e})}),"series"===e.componentType&&_.each(GVR.JSON.area_json,function(t,a){_.each(t,function(t){e.name===t&&_.each(GVR.JSON.area_json[a],function(e,t){0!==t&&r.dispatchAction({type:"mapSelect",name:e})})})}))}),r.on("globalout",function(e){_.each(GVR.JSON.provinceArray,function(e){r.dispatchAction({type:"mapUnSelect",name:e})})}),r.on("click",function(e){if("markPoint"===e.componentType&&!$(".img-rotate.active#use").length){console.log(e);var t=$("#init-url"),a=$("#content"),n="http://121.42.187.170:9000"+t.attr("url2");$.when(index.vbigdisplay_ajax_init(a,{},n)).done(function(t){console.log(t),_.each(t,function(t){if(t.hospital_name===e.name){switch(t.updata_at=t.updata_at.replace(/\s\d{2}:\d{2}:\d{2}/g,""),Number(t.business_status)){case 1:t.status="拜访中";break;case 2:t.status="洽谈中";break;case 3:t.status="确定意向";break;case 4:t.status="部署中";break;case 5:t.status="培训中";break;default:t.status="使用中"}var a=r.getDom(),n=$(a).width(),i=$(a).height(),l=$("body");l.find(".hospital-alert").remove();var c=$(o.alert_map_tpl(t));c.find(".hospital-title").css("color",e.color),c.find(".alert-radius-border").css("border-color",e.color),l.append(c);var s=c.height(),p=c.width(),m=e.event.offsetX+p/8,f=e.event.offsetY-s/7;m+p>n&&(m=e.event.offsetX-p),f+s>i?(f=e.event.offsetY-2*s/3,m=e.event.offsetX-p/2+11):f<10&&(f=e.event.offsetY+2*s/3-25,m=e.event.offsetX-p/2+11),c.css({"border-color":e.color,left:m+"px",top:f+"px"})}})})}}),r.on("mousedown",function(e){var t=$("body");t.find(".hospital-alert").remove()}),r.setOption(c),GVR.ECHARTS.AREA_MAP=r})}};$(function(){ECHARTS_FUNC.ready_init()});